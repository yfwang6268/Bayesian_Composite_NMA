---
title: "variance comparision"
output:
  pdf_document: default
  html_notebook: default
---

This file is to compare the variance from the simulation. Based on the result, we calcuate three types of simulations

1. Posterior variance: variance estimated from the posterior distribution, take average of 500 samples
2. Sandwich variance: variance estimated by sandwich method, taking average of 500 samples
   $$
   \text{Cov} \left(\mu_k^{XZ}, \tau_k^{XZ^2}\right) = \frac{1}{n} \text{H}^{-1}\left(\mu_k^{XZ},
   \tau_k^{XZ^2}\right) \text{J}\left(\mu_k^{XZ}, \tau_k^{XZ^2}\right)\text{H}^{-1}\left(\mu_k^{XZ},
   \tau_k^{XZ^2}\right)
   $$
3. MCMC variance: variance estimated by 500 simulations

```{r, include=FALSE}
load("simulation_result_no_adjust_var_seed1_2023-05-26.RData")
mu_var_mcmc = posterior_mu_var_mcmc
mu_var_sandwich = posterior_mu_var_sandwich
tau_var_mcmc = posterior_tau_var_mcmc
tau_var_sandwich = posterior_tau_var_sandwich

load("simulation_result_no_adjust_var_seed2_2023-05-26.RData")
mu_var_mcmc = rbind(mu_var_mcmc, posterior_mu_var_mcmc)
mu_var_sandwich = rbind(mu_var_sandwich,posterior_mu_var_sandwich)
tau_var_mcmc = rbind(tau_var_mcmc, posterior_tau_var_mcmc)
tau_var_sandwich = rbind(tau_var_sandwich, posterior_tau_var_sandwich)

load("simulation_result_no_adjust_var_seed3_2023-05-26.RData")
mu_var_mcmc = rbind(mu_var_mcmc, posterior_mu_var_mcmc)
mu_var_sandwich = rbind(mu_var_sandwich,posterior_mu_var_sandwich)
tau_var_mcmc = rbind(tau_var_mcmc, posterior_tau_var_mcmc)
tau_var_sandwich = rbind(tau_var_sandwich, posterior_tau_var_sandwich)

mu_var_mcmc = colMeans(mu_var_mcmc)
mu_var_sandwich = colMeans(mu_var_sandwich)
tau_var_mcmc = colMeans(tau_var_mcmc)
tau_var_sandwich  =  colMeans(tau_var_sandwich)

mu_var_sim = apply(posterior_mu,2,var)
tau_var_sim = apply(posterior_tau,2,var)

mu_result = rbind(mu_var_mcmc, mu_var_sandwich,mu_var_sim)
mu_result = mu_result[,-c(3,6)]
tau_result = rbind(tau_var_mcmc, tau_var_sandwich,tau_var_sim)
tau_result = tau_result[,-c(3,6)]
```

Variance Estimation for $\mu$

```{r,echo=FALSE}
mu_result  = data.frame(mu_result)
rownames(mu_result) = c("Posterior", "Sandwich", "MC")
colnames(mu_result) = c("BA1", "CA1", "BA2", "CA2")
print(round(mu_result,6))
```

Variance estimate for $\tau$

```{r,echo=FALSE}
tau_result  = data.frame(tau_result)
rownames(tau_result) = c("Posterior", "Sandwich", "MC")
colnames(tau_result) = c("BA1", "CA1", "BA2", "CA2")
print(round(tau_result,6))
```